function mtlImageView(t,e){this.mIsLoaded=!1,this.mContainElement=t,this.mImageElement=null,this.mOptions=e,this.Init()}function mtlASwipe(t){this.mContainElement=t,this.mArrData=[],this.mPosition=-1,this.mPrevPage=null,this.mCurrentPage=null,this.mNextPage=null,this.mCachPage=[],this.mEvent={},this.Init()}function mtlGalleryView(t){this.mFixWidth=!0,mtlASwipe.call(this,t)}mtlImageView.prototype.Init=function(){var t=this;this.SetEvent(),this.mContainElement.style.position="relative",this.mContainElement.style.overflow="auto",this.mContainElement.style.bakgroundColor="rgb(235,235,235)",this.mImageElement=new Image,this.mImageElement.style.position="absolute",this.mImageElement.style.left="0",this.mImageElement.style.right="0",this.mImageElement.style.top="0",this.mImageElement.style.bottom="0",this.mImageElement.onload=function(){t.mIsLoaded=!0,t.StopWait(),null!=t.mSize?t.ResetAlign(t.mSize.width,t.mSize.height):t.ResetAlign()},this.mImageElement.onerror=function(){t.StopWait()},this.mContainElement.appendChild(this.mImageElement),this.mImageElement.ondragstart=function(){return!1}},mtlImageView.prototype.StopWait=function(){this.mWaitCursor&&(this.mContainElement.removeChild(this.mWaitCursor),this.mWaitCursor=null)},mtlImageView.prototype.StartWait=function(){this.mWaitCursor=document.createElement("div"),this.mWaitCursor.style.position="absolute",this.mWaitCursor.style.left="0",this.mWaitCursor.style.right="0",this.mWaitCursor.style.top="0",this.mWaitCursor.style.bottom="0",this.mWaitCursor.style.width="50px",this.mWaitCursor.style.height="50px",this.mWaitCursor.style.borderColor="rgb(235,235,235)",this.mWaitCursor.style.borderWidth="8px",this.mWaitCursor.style.borderStyle="solid",this.mWaitCursor.style.margin="auto",this.mWaitCursor.style.borderRadius="50%",this.mWaitCursor.style.borderTop="8px solid #3498db",this.mWaitCursor.className=".ImgWaitCursor",this.mContainElement.appendChild(this.mWaitCursor)},mtlImageView.prototype.LoadImage=function(t){this.mImageElement.src="",this.mIsLoaded=!1,null!=t&&0<t.length?(this.StartWait(),this.mImageElement.src=t):this.StopWait()},mtlImageView.prototype.ResetAlign=function(t,e){var i=t||this.mContainElement.clientWidth,n=e||this.mContainElement.clientHeight,m=null==this.mOptions||null==this.mOptions.FixWidth||this.mOptions.FixWidth,l=m?this.mImageElement.naturalHeight/this.mImageElement.naturalWidth:this.mImageElement.naturalWidth/this.mImageElement.naturalHeight,o=m?i:n*l,a=m?l*i:n;m?this.mContainElement.mWidth=o:this.mContainElement.mHeight=a,this.mImageElement.style.margin=a<=n?"auto":o<=i?"0 auto":"",this.mImageElement.style.width=o+"px",this.mImageElement.style.height=a+"px"},mtlImageView.prototype.DobleTouch=function(t,i,n){var e,m,l,o,a,s=this,h=null==this.mOptions||null==this.mOptions.FixWidth||this.mOptions.FixWidth;null==this.mContainElement.mDobleTouchCnt?(this.mContainElement.mDobleTouchCnt=1,this.mContainElement.mClickTimer=setTimeout(function(){s.mContainElement.mClickTimer=null,s.mContainElement.mDobleTouchCnt=null},300)):this.mContainElement.mDobleTouchCnt=this.mContainElement.mDobleTouchCnt+1,this.mContainElement.mClickTimer&&2==this.mContainElement.mDobleTouchCnt&&(e=h?this.mImageElement.naturalHeight/this.mImageElement.naturalWidth:this.mImageElement.naturalWidth/this.mImageElement.naturalHeight,l=m=0,h?(m=2*this.mContainElement.mWidth,t.mWidth>this.mContainElement.clientWidth&&(m=this.mContainElement.clientWidth),this.mContainElement.mWidth,m<t.clientWidth?m=this.mContainElement.clientWidth:this.mContainElement.mWidth=m,l=e*m):(l=3*this.mContainElement.mHeight,this.mContainElement.mHeight>this.mContainElement.clientHeight&&(l=this.mContainElement.clientHeight),this.mContainElement.mHeight,l<this.mContainElement.clientHeight?l=this.mContainElement.clientHeight:this.mContainElement.mHeight=l,m=e*l),o=this.mImageElement.clientWidth,a=this.mImageElement.clientHeight,$(this.mImageElement).animate({width:m,height:l},{duration:300,step:function(t,e){"width"==e.prop?(s.mImageElement.clientHeight<=s.mContainElement.clientHeight?s.mImageElement.style.margin="auto":t<=s.mContainElement.clientWidth?s.mImageElement.style.margin="0 auto":s.mImageElement.style.margin="",s.setScrollX(i,t-o),o=t):(t<=s.mContainElement.clientHeight?s.mImageElement.style.margin="auto":s.mImageElement.clientWidth<=s.mContainElement.clientWidth?s.mImageElement.style.margin="0 auto":s.mImageElement.style.margin="",s.setScrollY(n,t-a),a=t)}}))},mtlImageView.prototype.SetFixWidth=function(t){null==this.mOptions&&(this.mOptions={}),this.mOptions.FixWidth=t,this.ResetAlign()},mtlImageView.prototype.GetFixWidth=function(){return!this.mOptions||!this.mOptions.FixWidth||this.mOptions.FixWidth},mtlImageView.prototype.isIOS=function(){return(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints)&&!window.MSStream},mtlImageView.prototype.isAndroid=function(){return/Android/i.test(navigator.userAgent)},mtlImageView.prototype.setScrollX=function(t,e){null==this.mOptions||null==this.mOptions.FixWidth||this.mOptions.FixWidth;var i=e*t/(this.mContainElement.clientWidth/2)/2;this.mContainElement.scrollLeft=this.mContainElement.scrollLeft+i,this.mContainElement.scrollLeft<0&&(this.mContainElement.scrollLeft=0)},mtlImageView.prototype.setScrollY=function(t,e){null==this.mOptions||null==this.mOptions.FixWidth||this.mOptions.FixWidth;var i=e*t/(this.mContainElement.clientHeight/2)/2;this.mContainElement.scrollTop=this.mContainElement.scrollTop+i,this.mContainElement.scrollTop<0&&(this.mContainElement.scrollTop=0)},mtlImageView.prototype.canSWape=function(){var t=0,e=this.mImageElement.clientWidth-this.mContainElement.scrollLeft-this.mContainElement.clientWidth;return MyLog(this.mImageElement.clientWidth+","+this.mContainElement.scrollLeft+","+this.mContainElement.clientWidth),e<=3&&(t|=1),this.mContainElement.scrollLeft<=.5&&(t|=16),t},mtlImageView.prototype.setScroll=function(t,e,i,n){var m=null==this.mOptions||null==this.mOptions.FixWidth||this.mOptions.FixWidth,l=m?i*t/(this.mContainElement.clientWidth/2)/2:i*n*t/(this.mContainElement.clientWidth/2)/2,o=m?i*n*e/(this.mContainElement.clientHeight/2)/2:i*e/(this.mContainElement.clientHeight/2)/2;this.mContainElement.scrollLeft=this.mContainElement.scrollLeft+l,this.mContainElement.scrollLeft<0&&(this.mContainElement.scrollLeft=0),this.mContainElement.scrollTop=this.mContainElement.scrollTop+o,this.mContainElement.scrollTop<0&&(this.mContainElement.scrollTop=0)},mtlImageView.prototype.SetEvent=function(){var r=this;0==this.isIOS()&&0==this.isAndroid()&&this.mContainElement.addEventListener("mousedown",function(t){t=t||window.event,r.DobleTouch(t.currentTarget,t.x,t.y)}),this.mContainElement.addEventListener("touchstart",function(t){var e,i,n;1<(t=t||window.event).touches.length?((e=t.currentTarget).mCenterX=(t.touches[0].clientX+t.touches[1].clientX)/2,e.mCenterY=(t.touches[0].clientY+t.touches[1].clientY)/2,i=t.touches[0].clientX-t.touches[1].clientX,n=t.touches[0].clientY-t.touches[1].clientY,e.mDif=Math.sqrt(i*i+n*n),t.preventDefault()):1==t.touches.length&&r.DobleTouch(t.currentTarget,t.touches[0].clientX,t.touches[0].clientY)}),this.mContainElement.addEventListener("touchmove",function(t){var e,i,n,m,l,o,a,s,h;1<(t=t||window.event).touches.length&&(e=null==r.mOptions||null==r.mOptions.FixWidth||r.mOptions.FixWidth,i=t.currentTarget,n=t.touches[0].clientX-t.touches[1].clientX,m=t.touches[0].clientY-t.touches[1].clientY,o=2*((l=Math.sqrt(n*n+m*m))-i.mDif),a=e?r.mImageElement.naturalHeight/r.mImageElement.naturalWidth:r.mImageElement.naturalWidth/r.mImageElement.naturalHeight,h=s=0,e?((s=i.mWidth+o)<i.clientWidth?s=i.clientWidth:(i.mWidth=s,i.mDif=l),h=a*s):((h=i.mHeight+o)<i.clientHeight?h=i.clientHeight:(i.mHeight=h,i.mDif=l),s=a*h),r.mImageElement.style.width=s+"px",r.mImageElement.style.height=h+"px",h<=i.clientHeight?r.mImageElement.style.margin="auto":s<=i.clientWidth?r.mImageElement.style.margin="0 auto":r.mImageElement.style.margin="",r.setScroll(i.mCenterX,i.mCenterY,o,a,!1)),1<t.touches.length&&t.preventDefault()}),this.mContainElement.addEventListener("touchend",function(t){(t=t||window.event).cancelable&&t.preventDefault()}),this.mContainElement.addEventListener("touchcancel",function(t){(t=t||window.event).cancelable&&t.preventDefault()})},mtlASwipe.prototype.PushCachPage=function(t){this.mCachPage[this.mCachPage.length]=t},mtlASwipe.prototype.PopCachPage=function(){if(this.mCachPage.length<=0)return null;var t=this.mCachPage[this.mCachPage.length-1];return this.mCachPage.splice(this.mCachPage.length-1,1),t},mtlASwipe.prototype.Init=function(){this.mContainElement.style.overflow="hidden",this.mContainElement.style.whiteSpace="nowrap",this.SetEvent()},mtlASwipe.prototype.SetContents=function(t,e,i){for(var n=this.mContainElement.children,m=n.length-1;0<=m;m--)this.PushCachPage(n[m]),this.mContainElement.removeChild(n[m]);this.mArrData=t,this.mPosition=-1,this.SetPosition(e,i)},mtlASwipe.prototype.AddData=function(t){if(this.mArrData.push(t),-1==this.mPosition)this.SetPosition(0,!1);else{for(var e,i=this.mContainElement.children,n=i.length,m=-1,l=0;l<n;l++)i[l].mIndex==this.mPosition?m=0:-1!=m&&m++;if(0<2-m)for(var o=this.mArrData.length,l=this.mPosition+m+1;l<o;l++)null==(e=this.PopCachPage())&&(e=this.CreatePage()),this.BindPage(e,l),this.mContainElement.appendChild(e)}},mtlASwipe.prototype.GetPosition=function(){return this.mPosition},mtlASwipe.prototype.SetPosition=function(e,t){var n=this;if(!(e>=this.mArrData.length||e<0||e==this.mPosition||this.mContainElement.mAnimating)){var i,m=this.mPosition;if(-1==m){null==(i=this.PopCachPage())&&(i=this.CreatePage()),this.BindPage(i,e),this.mContainElement.appendChild(i);for(var l=1;l<=2;l++)0<=e-l&&(null==(i=this.PopCachPage())&&(i=this.CreatePage()),this.BindPage(i,e-l),this.mContainElement.insertBefore(i,this.mContainElement.children[0]));for(l=1;l<=2;l++)e+l<this.mArrData.length&&(null==(i=this.PopCachPage())&&(i=this.CreatePage()),this.BindPage(i,e+l),this.mContainElement.appendChild(i));var o=0;e<=2?o=e:(o=2,this.mContainElement.scrollLeft=0);var a=o*this.mContainElement.clientWidth;t?(this.mContainElement.mAnimating=!0,$(this.mContainElement).animate({scrollLeft:a},100,function(){n.mContainElement.mAnimating=!1})):this.mContainElement.scrollLeft=a}else{var s=e-m;if(0!=s)if(0<s&&s<=2){for(var h=-1,r=(p=this.mContainElement.children).length,l=0;l<r;l++)if(p[l].mIndex==e){h=l;break}if(-1!=h){for(var c=1,l=h+1;l<=h+2;l++)l>=p.length&&e+c<this.mArrData.length&&(null==(i=this.PopCachPage())&&(i=this.CreatePage()),this.BindPage(i,e+c),this.mContainElement.appendChild(i)),c++;function u(){c=0,r=p.length;for(var t=0;t<r&&p[t].mIndex!=e;t++)c++;for(t=c-2-1;0<=t;t--)n.PushCachPage(p[t]),n.mContainElement.removeChild(p[t]);c=0,r=p.length;for(t=0;t<r&&p[t].mIndex!=e;t++)c++;n.mContainElement.scrollLeft=c*n.mContainElement.clientWidth}a=h*this.mContainElement.clientWidth;t?(this.mContainElement.mAnimating=!0,$(this.mContainElement).animate({scrollLeft:a},100,function(){u(),n.mContainElement.mAnimating=!1})):(this.mContainElement.scrollLeft=a,u())}}else if(s<0&&-2<=s){for(h=-1,r=(p=this.mContainElement.children).length,c=0,l=0;l<r;l++){if(p[l].mIndex==e){h=l;break}c++}if(-1!=h){var d=2-c,g=0;for(l=1;l<=d;l++)0<=e-c-l&&(null==(i=this.PopCachPage())&&(i=this.CreatePage()),this.BindPage(i,e-c-l),this.mContainElement.insertBefore(i,p[0]),g++);if(0<g){r=p.length;for(l=c=0;l<r;l++){if(p[l].mIndex==e){h=l;break}c++}n.mContainElement.scrollLeft=(c+1)*n.mContainElement.clientWidth;var a=c*this.mContainElement.clientWidth,C=function(){for(var t=0,e=[],i=c+1;i<r;i++)2<=t&&e.push(p[i]),t++;for(i=0;i<e.length;i++)n.PushCachPage(e[i]),n.mContainElement.removeChild(e[i])};t?(this.mContainElement.mAnimating=!0,$(this.mContainElement).animate({scrollLeft:a},100,function(){C(),n.mContainElement.mAnimating=!1})):(this.mContainElement.scrollLeft=a,C())}else{a=e*this.mContainElement.clientWidth,C=function(){for(var t=0,e=[],i=c+1;i<r;i++)2<=t&&e.push(p[i]),t++;for(i=0;i<e.length;i++)n.PushCachPage(e[i]),n.mContainElement.removeChild(e[i])};t?(this.mContainElement.mAnimating=!0,$(this.mContainElement).animate({scrollLeft:a},100,function(){C(),n.mContainElement.mAnimating=!1})):(this.mContainElement.scrollLeft=a,C())}}}else{for(var p=this.mContainElement.children,l=(r=p.length)-1;0<=l;l--)this.PushCachPage(p[l]),this.mContainElement.removeChild(p[l]);null==(i=this.PopCachPage())&&(i=this.CreatePage()),this.BindPage(i,e),this.mContainElement.appendChild(i);for(l=1;l<=2;l++)0<=e-l&&(null==(i=this.PopCachPage())&&(i=this.CreatePage()),this.BindPage(i,e-l),this.mContainElement.insertBefore(i,this.mContainElement.children[0]));for(l=1;l<=2;l++)e+l<this.mArrData.length&&(null==(i=this.PopCachPage())&&(i=this.CreatePage()),this.BindPage(i,e+l),this.mContainElement.appendChild(i));o=0;e<=2?o=e:(o=2,this.mContainElement.scrollLeft=0);a=o*this.mContainElement.clientWidth;t?(this.mContainElement.mAnimating=!0,$(this.mContainElement).animate({scrollLeft:a},100,function(){n.mContainElement.mAnimating=!1})):this.mContainElement.scrollLeft=a}}this.mEvent.onChange&&this.mEvent.onChange(this.mContainElement,e),this.mPosition=e}},mtlASwipe.prototype.CreatePage=function(){return null},mtlASwipe.prototype.BindPage=function(t,e){t.mIndex=e},mtlASwipe.prototype.isIOS=function(){return(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints)&&!window.MSStream},mtlASwipe.prototype.isAndroid=function(){return/Android/i.test(navigator.userAgent)},mtlASwipe.prototype.SetEvent=function(){var m=this;0==this.isIOS()&&0==this.isAndroid()&&(this.mContainElement.addEventListener("mousedown",function(t){var e=m.mContainElement;t=t||window.event,e.mX=t.x,e.mbeforeScrollLeft=e.scrollLeft}),this.mContainElement.addEventListener("mousemove",function(t){var e,i=m.mContainElement;null!=i.mX&&(t=t||window.event,e=i.mX-t.x,Math.round(i.scrollLeft/i.clientWidth),i.scrollLeft=i.mbeforeScrollLeft+e)}),this.mContainElement.addEventListener("mouseup",function(t){var e=m.mContainElement;null!=e.mX&&(t=t||window.event,m.EndMouse(e,t.x))}),this.mContainElement.addEventListener("mouseout",function(t){var e=m.mContainElement;null!=e.mX&&(t=t||window.event,m.EndMouse(e,t.x))})),this.mContainElement.addEventListener("touchstart",function(t){var e=m.mContainElement;t=t||window.event,e.mStartIndex=Math.round(e.scrollLeft/e.clientWidth),e.mX=t.touches[0].clientX,e.mbeforeScrollLeft=e.scrollLeft,e.mMobileBeforeX=e.mX,e.mMobileBeforeDir=0}),this.mContainElement.addEventListener("touchmove",function(t){var e=m.mContainElement;if(null!=e.mX){var i=$(e.children[e.mStartIndex]).ImgView("canSWape");if(1<(t=t||window.event).touches.length)return;var n=e.mX-t.touches[0].clientX;MyLog("Touchmove "+i),16&i&&n<0||1&i&&0<n?(e.mMobileBeforeX=t.touches[0].clientX,e.mMobileBeforeDir=n,e.scrollLeft=e.mbeforeScrollLeft+n):e.mX=t.touches[0].clientX}}),this.mContainElement.addEventListener("touchend",function(t){var e=m.mContainElement;t=t||window.event,m.EndMouse(e,e.mMobileBeforeX-e.mMobileBeforeDir)}),this.mContainElement.addEventListener("touchcancel",function(t){var e=m.mContainElement;t=t||window.event,m.EndMouse(e,e.mMobileBeforeX-e.mMobileBeforeDir)})},mtlASwipe.prototype.GetSwipeSelectedPageIndex=function(t){return Math.round(t.scrollLeft/t.clientWidth)},mtlASwipe.prototype.EndMouse=function(t,e){var i=t.mX-e,n=this.GetSwipeSelectedPageIndex(t),m=t.scrollLeft/t.clientWidth,l=Math.floor(t.scrollLeft/t.clientWidth);difPoint=m-l,.8<=difPoint?this.setAnimationSwipe(t,t.clientWidth*n):.5<difPoint?i<=0?this.setAnimationSwipe(t,t.clientWidth*(n-1)):this.setAnimationSwipe(t,t.clientWidth*n):difPoint<=.2?this.setAnimationSwipe(t,t.clientWidth*n):difPoint<=.5&&(0<=i?this.setAnimationSwipe(t,t.clientWidth*(n+1)):this.setAnimationSwipe(t,t.clientWidth*n)),t.mX=null,t.mbeforeScrollLeft=null},mtlASwipe.prototype.setAnimationSwipe=function(e,t){var i=this;$(e).animate({scrollLeft:t},100,function(){var t=i.GetSwipeSelectedPageIndex(e);i.SetPosition(e.children[t].mIndex,!1)})},mtlASwipe.prototype.OnMouseDown=function(t,e){e=e||window.event,t.mX=e.x,t.mbeforeScrollLeft=t.scrollLeft},mtlGalleryView.prototype=Object.create(mtlASwipe.prototype),(mtlGalleryView.prototype.constructor=mtlGalleryView).prototype.BindPage=function(t,e){mtlASwipe.prototype.BindPage.call(this,t,e),$(t).ImgView("load",{url:this.mArrData[e],fixwidth:this.mFixWidth})},mtlGalleryView.prototype.SetFixWidth=function(t){this.mFixWidth=t;for(var e=this.mContainElement.children,i=e.length,n=0;n<i;n++)e[n].mObjectView.SetFixWidth(t)},mtlGalleryView.prototype.GetFixWidth=function(){return this.mFixWidth},mtlGalleryView.prototype.CreatePage=function(){var t=document.createElement("div");return t.style.display="inline-block",t.style.position="relative",t.style.width="100%",t.style.height="100%",t},jQuery.prototype.ImgView=function(t,e){if(null!=this[0]){var i=null;if("class"!=t)if(null==(i=this[0].mObjectView)&&(i=new mtlImageView(this[0],e),this[0].mObjectView=i),"load"==t)null!=e.size&&(i.mSize=e.size),i.LoadImage(e.url),null!=e.fixwidth&&i.SetFixWidth(e.fixwidth);else if("setFixWidth"==t)i.SetFixWidth(e);else{if("getFixWidth"==t)return i.GetFixWidth();if("resize"==t)i.mSize=e,i.ResetAlign(e.width,e.height);else{if("canSWape"==t)return i.canSWape();if("isLoaded"==t)return i.mIsLoaded;if("clear"==t)return i.LoadImage("")}}else for(var n=!0,m=0;m<this.length;m++)null==(i=this[m].mObjectView)&&(i=new mtlImageView(this[m],e),this[m].mObjectView=i,$(this[m]).attr("fixwidth")&&(n="true"==$(this[m]).attr("fixwidth")),i.SetFixWidth(n),i.LoadImage($(this[m]).attr("src")))}},jQuery.prototype.GalleryView=function(t,e){if(null!=this[0]){var i=null;if("class"!=t)if(null==(i=this[0].mObjectView)&&(i=new mtlGalleryView(this[0],e),this[0].mObjectView=i),"setContents"==t)i.SetContents(e.contents,e.position?e.position:0,!!e.animation&&e.animation);else if("setPosition"==t)i.SetPosition(e.position?e.position:0,!!e.animation&&e.animation);else{if("getPosition"==t)return i.GetPosition();if("addData"==t)i.AddData(e);else if("setEvent"==t)i.mEvent=e;else if("setFixWidth"==t)i.SetFixWidth(e);else{if("getFixWidth"==t)return i.GetFixWidth();if("getCount"==t)return i.mArrData.length;if("getAt"==t)return i.mArrData[e]}}else for(var n,m,l,o,a=0;a<this.length;a++){null==(i=this[a].mObjectView)&&(i=new mtlGalleryView(this[a],e),this[a].mObjectView=i,l=[],n=0,$(this[a]).attr("contents")&&(m=$(this[a]).attr("contents").replace(/'/gi,'"'),l=JSON.parse(m)),$(this[a]).attr("position")&&(n=Number($(this[a]).attr("position"))),o=!0,$(this[a]).attr("fixwidth")&&(o="true"==$(this[a]).attr("fixwidth")),i.SetFixWidth(o),i.SetContents(l,n,!1))}}},$(function(){$("[class=mtlImageView]").ImgView("class"),$("[class=mtlGalleryView]").GalleryView("class")});
